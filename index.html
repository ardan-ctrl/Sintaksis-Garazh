
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Синтаксис-Гараж</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Общие стили и настройка темы */
        :root {
            --background-color: #2c2c2c;
            --text-color: #ffffff;
            --accent-green: #39ff14;
            --accent-orange: #ff9900;
            --card-background: #3a3a3a;
            --font-pixel: 'Press Start 2P', cursive;
            --font-mono: 'Roboto Mono', monospace;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-mono);
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        /* Стилизация заголовка */
        .header-title {
            font-family: var(--font-pixel);
            color: var(--accent-green);
            font-size: 2rem;
            text-shadow: 0 0 5px var(--accent-green), 0 0 10px var(--accent-green);
            margin-bottom: 20px;
            text-align: center;
        }

        /* Контейнер для 3D-перспективы карточки */
        .card-container {
            perspective: 1500px;
            width: 100%;
            max-width: 600px;
            height: 400px;
        }

        /* Сама карточка (вращающийся элемент) */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .card.is-flipped {
            transform: rotateY(180deg);
        }

        /* Общие стили для обеих сторон карточки */
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            background-color: var(--card-background);
            border: 3px solid var(--accent-green);
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(57, 255, 20, 0.3);
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            overflow-y: auto;
        }

        /* Стилизация контента на карточке */
        .card-title {
            font-family: var(--font-pixel);
            color: var(--accent-orange);
            font-size: 1.1rem;
            margin-bottom: 15px;
            text-shadow: 0 0 5px var(--accent-orange);
            flex-shrink: 0;
        }
        
        .card-content {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .card-content p {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        
        .card-content .label {
            font-weight: 700;
            color: var(--accent-green);
        }

        .card-content .code {
            background-color: #222;
            padding: 5px 10px;
            border-radius: 5px;
            border-left: 3px solid var(--accent-orange);
            display: inline-block;
            margin-top: 5px;
        }
        
        /* Задняя сторона карточки изначально повернута */
        .card-back {
            transform: rotateY(180deg);
            border-color: var(--accent-orange);
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.3);
        }

        .card-back .label {
             color: var(--accent-orange);
        }
        
        .answer-hidden {
            display: none;
        }
        
        .card-content .btn {
            display: block;
            margin: 15px auto 0;
            width: 80%;
            max-width: 250px;
        }
        
        /* Стили для блока с практическим заданием */
        .practice-item {
            margin-top: 15px;
        }
       
        /* Панель управления (кнопки) */
        #cardsSection .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
        }

        .btn {
            font-family: var(--font-pixel);
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease-in-out;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #cardsSection .nav-btn-style {
            background-color: var(--accent-green);
            color: #000;
        }

        #cardsSection .nav-btn-style:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px var(--accent-green), 0 0 20px var(--accent-green);
        }
        
        .check-btn {
            background-color: var(--accent-orange);
            color: #000;
        }
        
        .check-btn:not(:disabled):hover {
            transform: translateY(-2px);
            box-shadow: 0 0 10px var(--accent-orange), 0 0 20px var(--accent-orange);
        }

        /* Navigation Styles */
        .nav-menu {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
        }
        .nav-btn {
            font-family: 'Press Start 2P', cursive;
            font-size: 16px;
            color: white;
            background-color: #444;
            border: 2px solid #ff9900;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background-color: #ff9900;
            color: #2c2c2c;
        }

        .nav-btn.active {
            background-color: #39ff14;
            color: #2c2c2c;
            border-color: #39ff14;
        }

        /* Content Section Styles */
        .content-section {
            display: none; 
            width: 100%;
            flex-direction: column;
            align-items: center;
            animation: sectionFadeIn 0.5s ease-in-out;
        }
        
        @keyframes sectionFadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .content-section.active {
            display: flex;
        }

        /* Progress Bar & Bike Styles */
        .progress-container {
            width: 100%;
            max-width: 600px;
            background-color: #555;
            border-radius: 10px;
            margin-top: 20px;
            height: 30px;
            position: relative;
            border: 2px solid #222;
        }
        
        #bike-container {
            position: absolute;
            bottom: 5px;
            left: 0;
            width: 50px; /* Ширина байка */
            height: auto;
            transform: translateX(-50%);
            transition: left 0.5s ease-out;
            animation: bikeBob 1s ease-in-out infinite;
        }
        
        @keyframes bikeBob {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-3px); }
        }

        #pit-bike-svg {
            width: 100%;
            height: auto;
            filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.5));
        }

        .progress-bar-fill {
            height: 100%;
            width: 0%; /* Initial width */
            background: linear-gradient(90deg, var(--accent-green), var(--accent-orange));
            border-radius: 8px;
            transition: width 0.5s ease-out;
        }
        
        .progress-bar-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-family: var(--font-pixel);
            font-size: 14px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.7);
        }

        #testSection {
            color: white;
            text-align: left;
            padding: 20px;
            max-width: 800px;
            margin: 20px auto;
            border: 2px solid #39ff14;
            border-radius: 10px;
            background-color: var(--card-background);
        }

        /* Quiz Styles */
        .level-header {
            color: #ff9900;
            margin-top: 30px;
            border-bottom: 2px solid #ff9900;
            padding-bottom: 5px;
            font-family: var(--font-pixel);
            font-size: 1rem;
        }

        .quiz-question {
            background-color: #3d3d3d;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 5px solid #39ff14;
        }
        
        .quiz-question p {
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .quiz-controls {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }

        .hint-btn {
            background-color: transparent;
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
            padding: 5px 10px;
            font-family: var(--font-mono);
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.8rem;
            transition: all 0.2s ease;
        }

        .hint-btn:hover:not(:disabled) {
            background-color: var(--accent-green);
            color: var(--background-color);
        }

        .hint-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .hint-text {
            display: none;
            background-color: #2a2a2a;
            border-left: 3px solid var(--accent-green);
            padding: 8px;
            margin-bottom: 15px;
            border-radius: 4px;
            color: #ddd;
            font-style: italic;
            font-size: 0.9rem;
        }

        .answer-options button {
            display: block;
            width: 100%;
            text-align: left;
            background-color: #555;
            color: white;
            border: 1px solid #777;
            padding: 10px;
            margin-top: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Roboto Mono', monospace;
            transition: background-color 0.3s;
        }

        .answer-options button:hover:not(:disabled) {
            background-color: #777;
        }

        .answer-options button.correct {
            background-color: #28a745; /* Green */
            border-color: #28a745;
        }

        .answer-options button.incorrect {
            background-color: #dc3545; /* Red */
            border-color: #dc3545;
        }

        .answer-options button:disabled {
            cursor: default;
            opacity: 0.7;
        }

        .explanation {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background-color: #2c2c2c;
            border-radius: 5px;
            color: #ccc;
        }
        
        .test-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        #checkResultsBtn, #newAttemptBtn {
            font-size: 1rem;
            width: 100%;
            flex-grow: 1;
        }
        #checkResultsBtn {
            background-color: var(--accent-orange);
            color: var(--background-color);
            border: 2px solid var(--accent-orange);
        }
        #newAttemptBtn {
             background-color: var(--accent-green);
            color: var(--background-color);
            border: 2px solid var(--accent-green);
        }

        #results-container {
            margin-top: 20px;
            font-size: 22px;
            font-family: 'Press Start 2P', cursive;
            color: #39ff14;
            text-align: center;
            width: 100%;
        }

        #results-container .feedback-message {
            margin: 15px 0;
            font-size: 1rem;
            font-family: var(--font-mono);
            line-height: 1.6;
            color: var(--text-color);
        }

        #results-container .feedback-low {
            color: var(--accent-orange);
        }

        #results-container .feedback-high {
            color: var(--accent-green);
        }

        #results-container .review-topics {
            list-style-type: '🔧 ';
            padding-left: 25px;
            margin-top: 10px;
            text-align: left;
            font-size: 0.9rem;
            display: inline-block;
        }

        #results-container .review-topics li {
            margin-bottom: 5px;
        }
        
        .results-actions {
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }
        
        .results-actions button {
            font-size: 0.9rem;
            flex-grow: 1;
            min-width: 180px;
        }


        /* Адаптивность */
        @media (max-width: 640px) {
            .header-title {
                font-size: 1.5rem;
            }
            .nav-menu {
                flex-direction: column;
                width: 100%;
            }
            .nav-btn {
                font-size: 14px;
            }
            .card-container {
                height: 450px;
            }
            .card-title {
                font-size: 1rem;
            }
            #cardsSection .controls {
                flex-wrap: wrap;
            }
            .btn {
                flex-grow: 1; /* Кнопки занимают равное место */
                min-width: 120px;
            }
            #check-btn {
                width: 100%;
                order: -1; /* Ставит кнопку "Проверить" сверху на мобильных */
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>

    <h1 class="header-title">Синтаксис-Гараж</h1>

    <!-- Навигационное меню -->
    <div class="nav-menu">
        <button id="cardsBtn" class="nav-btn active">Учебные карточки</button>
        <button id="testBtn" class="nav-btn">Тест-чемпионат</button>
    </div>

    <!-- Раздел с учебными карточками -->
    <div id="cardsSection" class="content-section active">
        <div class="card-container">
            <div id="card" class="card">
                <!-- Лицевая сторона карточки -->
                <div class="card-face card-front">
                    <h2 id="card-title-front" class="card-title"></h2>
                    <div id="card-content-front" class="card-content">
                        <!-- Контент будет вставлен из JS -->
                    </div>
                </div>
                <!-- Оборотная сторона карточки -->
                <div class="card-face card-back">
                    <h2 id="card-title-back" class="card-title">Тест-драйв</h2>
                    <div id="card-content-back" class="card-content">
                        <!-- Контент будет вставлен из JS -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Индикатор прогресса -->
        <div class="progress-container">
            <div id="bike-container">
                 <svg id="pit-bike-svg" viewBox="0 0 100 50" xmlns="http://www.w3.org/2000/svg">
                    <g fill="none" stroke-width="2">
                        <path stroke="#FF9900" d="M 20 30 L 30 20 L 50 20 L 60 15 L 75 15" />
                        <path stroke="#39FF14" d="M 30 20 L 25 40" />
                        <path stroke="#FFFFFF" d="M 50 20 L 60 40" />
                        <path stroke="#FFFFFF" d="M 75 15 L 70 30" />
                        <circle cx="25" cy="40" r="8" stroke="#FFFFFF" fill="#2c2c2c"/>
                        <circle cx="70" cy="40" r="8" stroke="#FFFFFF" fill="#2c2c2c"/>
                    </g>
                </svg>
            </div>
            <div id="progress-bar-fill" class="progress-bar-fill"></div>
            <span id="progress-bar-text" class="progress-bar-text"></span>
        </div>

        <div class="controls">
            <button id="prev-btn" class="btn nav-btn-style">◀ Предыдущая</button>
            <button id="check-btn" class="btn check-btn">Проверить</button>
            <button id="next-btn" class="btn nav-btn-style">Следующая ▶</button>
            <button id="goToTestBtn" class="btn check-btn" style="display: none;">К Тест-Чемпионату! 🏁</button>
        </div>
    </div>

    <!-- Раздел с тестом -->
    <div id="testSection" class="content-section">
      <h2>🏁 Тест-чемпионат "Синтаксис-Гараж" 🏁</h2>
      <p>Проверь свои скиллы! Каждый раз трасса будет новой.</p>
      
      <div id="quiz-container"></div>
    
      <div class="test-controls">
        <button id="checkResultsBtn" class="nav-btn">Проверить результаты</button>
        <button id="newAttemptBtn" class="nav-btn">Новая попытка</button>
      </div>
      <div id="results-container"></div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // =======================================================================
        // КОД v9.0 (с кнопкой перехода к тесту на последней карточке)
        // =======================================================================

        // -------------------- Глобальное состояние приложения --------------------
        let currentCardIndex = 0;
        let currentQuizQuestions = [];
        let userAnswers = [];

        // -------------------- Данные (карточки и вопросы) --------------------
        const cards = [
            // --- ЭТАП 1: СОБИРАЕМ ДВИГАТЕЛЬ (ОСНОВЫ) ---
            {
                title: "Этап 1.1: Главная деталь (Подлежащее)",
                front: {
                    mission: "Найди 'сердце' механизма — то, о чем идет речь.",
                    theory: "ПОДЛЕЖАЩЕЕ — главный герой предложения. Отвечает на вопросы КТО? или ЧТО? Это как рама у питбайка, на которой все держится.",
                    example: "Чит-код: (Кто?) <u>Гонщик</u> выигрывает. (Что?) <u>Питбайк</u> ревет."
                },
                back: {
                    task: "Тест-драйв: 'Молния сверкнула в небе.' Найди подлежащее.",
                    answer: "(что?) молния."
                }
            },
            {
                title: "Этап 1.2: Мощность двигателя (Сказуемое)",
                front: {
                    mission: "Узнай, что делает главная деталь.",
                    theory: "СКАЗУЕМОЕ — это действие подлежащего. Отвечает на вопросы ЧТО ДЕЛАЕТ? ЧТО СДЕЛАЕТ? и подобные. Это мощность твоего двигателя.",
                    example: "Чит-код: Гонщик (что делает?) <u>выигрывает</u>. Двигатель (что делает?) <u>ревет</u>."
                },
                back: {
                    task: "Тест-драйв: 'Гонщик умело вошел в поворот.' Найди сказуемое.",
                    answer: "гонщик (что сделал?) вошел."
                }
            },
            {
                title: "Этап 1.3: Сборка основы",
                front: {
                    mission: "Соедини 'раму' и 'двигатель' вместе!",
                    theory: "ГРАММАТИЧЕСКАЯ ОСНОВА = ПОДЛЕЖАЩЕЕ + СКАЗУЕМОЕ. Это минимальная рабочая сборка, без которой предложение не поедет.",
                    example: "Чит-код: '<u>Гонка началась</u>'. Основа: гонка началась."
                },
                back: {
                    task: "Собери основу: 'Аккумулятор самоката сел.'",
                    answer: "аккумулятор сел."
                }
            },

            // --- ЭТАП 2: ТЮНИНГ (ВТОРОСТЕПЕННЫЕ ЧЛЕНЫ) ---
            {
                title: "Этап 2.1: Дополнительный обвес",
                front: {
                    mission: "Сделай свой питбайк уникальным, добавив детали.",
                    theory: "ВТОРОСТЕПЕННЫЕ ЧЛЕНЫ — это все остальные слова в предложении, кроме основы. Они уточняют, добавляют детали и делают речь красивее. Это как наклейки, спойлеры и крутые диски.",
                    example: "Чит-код: 'Гонка началась [где?] <u>на трассе</u>'. '<u>На трассе</u>' — второстепенный член."
                },
                back: {
                    task: "Предложение 'Я быстро еду'. Основа: 'я еду'. Что здесь является 'тюнингом' (второстепенным членом)?",
                    answer: "Слово 'быстро'."
                }
            },
            {
                title: "Этап 2.2: Сток vs Тюнинг",
                front: {
                    mission: "Определи, есть ли на питбайке дополнительный обвес.",
                    theory: "НЕРАСПРОСТРАНЕННОЕ — только основа ('Сток' с завода). РАСПРОСТРАНЕННОЕ — есть хотя бы один второстепенный член ('Полный тюнинг').",
                    example: "Чит-код: '<u>Солнце село</u>' (Сток). '<u>Солнце село</u> за горизонт' (Тюнинг)."
                },
                back: {
                    task: "Есть тюнинг? 'Я установил новые грипсы.'",
                    answer: "Да! Есть второстепенные члены 'новые' и 'грипсы', значит, распространенное."
                }
            },

            // --- ЭТАП 3: НАСТРОЙКИ (ХАРАКТЕРИСТИКИ ПРЕДЛОЖЕНИЯ) ---
            {
                title: "Этап 3.1: Режим навигатора",
                front: {
                    mission: "Выбери цель поездки.",
                    theory: "ПО ЦЕЛИ ВЫСКАЗЫВАНИЯ предложения бывают: ПОВЕСТВОВАТЕЛЬНЫЕ (рассказ, '.'), ВОПРОСИТЕЛЬНЫЕ (спрашиваешь, '?'), ПОБУДИТЕЛЬНЫЕ (приказ или просьба, '.').",
                    example: "Чит-код: 'Я еду.' (рассказ). 'Ты едешь?' (вопрос). 'Поехали!' (приказ)."
                },
                back: {
                    task: "Какой режим? 'Не забудь зарядить аккумулятор.'",
                    answer: "Побудительное (просьба/приказ)."
                }
            },
            {
                title: "Этап 3.2: Режим 'Форсаж!'",
                front: {
                    mission: "Определи, насколько эмоциональна твоя поездка.",
                    theory: "ПО ИНТОНАЦИИ: НЕВОСКЛИЦАТЕЛЬНОЕ (спокойная речь, '.') и ВОСКЛИЦАТЕЛЬНОЕ (сильные эмоции, '!'). Любое предложение по цели может стать восклицательным.",
                    example: "Чит-код: 'Мы победили.' (спокойно). 'Мы победили!' (эмоции, 'Форсаж!')."
                },
                back: {
                    task: "Включен 'Форсаж'? 'Как круто мы прокатились!'",
                    answer: "Да, это восклицательное предложение."
                }
            },

            // --- ЭТАП 4: ПРОДВИНУТЫЕ АПГРЕЙДЫ (ОСЛОЖНЕНИЯ) ---
            {
                title: "Этап 4.1: Одинаковые детали (Однородные члены)",
                front: {
                    mission: "Найди одинаковые детали, которые выполняют одну и ту же работу.",
                    theory: "ОДНОРОДНЫЕ ЧЛЕНЫ — отвечают на один и тот же вопрос и относятся к одному слову. Как два колеса, два зеркала или две фары.",
                    example: "Чит-код: Механик [что сделал?] <u>починил</u>, <u>покрасил</u> и <u>протестировал</u> питбайк."
                },
                back: {
                    task: "Найди одинаковые детали: 'На трассе мы видели быстрые и маневренные мотоциклы.'",
                    answer: "Однородные определения: (какие?) быстрые и маневренные."
                }
            },
            {
                title: "Этап 4.2: Соединяем детали (Запятые при ОЧП)",
                front: {
                    mission: "Правильно подключи 'провода' (запятые).",
                    theory: "Запятая СТАВИТСЯ между однородными членами, если нет союзов. НЕ СТАВИТСЯ, если их соединяет один союз И, ИЛИ. СТАВИТСЯ, если союз И повторяется (и ..., и ...).",
                    example: "Чит-код: 'Я купил <u>шлем, перчатки</u>.' (запятая есть). 'Я купил <u>шлем и перчатки</u>.' (запятой нет)."
                },
                back: {
                    task: "Нужна ли 'искра' (запятая)? 'Гонщик проверил мотор и_надел шлем.'",
                    answer: "Нет. Союз 'и' одиночный, соединяет однородные сказуемые."
                }
            },
            {
                title: "Этап 4.3: Апгрейд 'Спойлер' (Причастный оборот)",
                front: {
                    mission: "Найди 'тюнинг-пакет', который описывает деталь.",
                    theory: "ПРИЧАСТНЫЙ ОБОРОТ — это причастие с зависимыми словами. Он описывает предмет, как крутой спойлер описывает машину.",
                    example: "Чит-код: Питбайк, [какой?] <u>сверкающий на солнце</u>."
                },
                back: {
                    task: "Найди 'спойлер': 'Мотоцикл, купленный вчера, стоял на старте.'",
                    answer: "купленный вчера."
                }
            },
            {
                title: "Этап 4.4: Крепление 'Спойлера' (Запятые при ПО)",
                front: {
                    mission: "Правильно прикрути 'спойлер' к корпусу.",
                    theory: "Если причастный оборот стоит ПОСЛЕ слова, которое он описывает, то он выделяется запятыми с двух сторон.",
                    example: "Чит-код: '<u>Гонщик</u>, [уставший после заезда], пил воду.' (после 'Гонщик' -> нужны запятые)."
                },
                back: {
                    task: "Нужны ли 'болты' (запятые)? 'Питбайк (?) стоявший в гараже (?) был готов к гонке.'",
                    answer: "Да, с двух сторон. Оборот стоит после слова 'питбайк'."
                }
            },

            // --- ЭТАП 5: УСТАНОВКА ВТОРОГО ДВИГАТЕЛЯ (СЛОЖНЫЕ ПРЕДЛОЖЕНИЯ) ---
            {
                title: "Этап 5.1: Один двигатель или два?",
                front: {
                    mission: "Посчитай количество основ в системе.",
                    theory: "ПРОСТОЕ предложение — одна грамматическая основа. СЛОЖНОЕ — две или больше основ.",
                    example: "Чит-код: '[<u>Гонка началась</u>], и [<u>питбайки сорвались</u> с места]'. Две основы -> сложное."
                },
                back: {
                    task: "Сколько здесь 'двигателей'? 'Наступила ночь, и на трассе зажглись фонари.'",
                    answer: "Два. 1: ночь наступила. 2: зажглись фонари. Это сложное предложение."
                }
            },
            {
                title: "Этап 5.2: Равноправные двигатели (ССП)",
                front: {
                    mission: "Найди два независимых двигателя, работающих вместе.",
                    theory: "СЛОЖНОСОЧИНЕННОЕ ПРЕДЛОЖЕНИЕ (ССП) — это две 'равноправные' основы, соединенные союзами И, А, НО. Части независимы друг от друга.",
                    example: "Чит-код: '[Гонка началась], и [зрители зашумели].'"
                },
                back: {
                    task: "Это ССП? 'Солнце село, но на трассе еще было светло.'",
                    answer: "Да. Основы: 'солнце село' и 'было светло' соединены союзом 'но'."
                }
            },
            {
                title: "Этап 5.3: Главный и вспомогательный двигатель (СПП)",
                front: {
                    mission: "Найди 'главный' блок и 'подчиненный' ему модуль.",
                    theory: "СЛОЖНОПОДЧИНЕННОЕ ПРЕДЛОЖЕНИЕ (СПП) — это 'главная' и 'зависимая' части. От главной к зависимой можно задать вопрос. Союзы: КОГДА, ЧТО, ПОТОМУ ЧТО, ЕСЛИ.",
                    example: "Чит-код: '[Я приеду на финиш] (когда?), [когда гонка закончится].'"
                },
                back: {
                    task: "Найди главный блок: 'Мы не поехали кататься, потому что пошел дождь.'",
                    answer: "Главный блок: 'Мы не поехали кататься' (почему?)"
                }
            },

            // --- ЭТАП 6: БОРТОВОЙ КОМПЬЮТЕР ---
            {
                title: "Этап 6.1: GPS-навигатор (Вводные слова)",
                front: {
                    mission: "Найди 'бортовой компьютер', который выражает мнение или порядок мыслей.",
                    theory: "ВВОДНЫЕ СЛОВА (кажется, к счастью, во-первых) не являются членами предложения. Их можно убрать без потери основного смысла. Всегда выделяются запятыми.",
                    example: "Чит-код: '[<u>К счастью</u>], мы успели на старт.' Убери 'к счастью' -> 'Мы успели на старт.' Смысл остался."
                },
                back: {
                    task: "Найди 'бортовой компьютер': 'Гонка, кажется, будет интересной.'",
                    answer: "'кажется'."
                }
            }
        ];

        const questionBank = [
            { level: 1, question: "Просканируй систему: 'Крипер медленно шипит.' Где здесь грамматическая основа?", options: ["крипер шипит", "медленно шипит", "крипер медленно"], correct: 0, explanation: "Основа — это подлежащее (кто? что?) и сказуемое (что делает?). Крипер (что делает?) шипит.", hint: "Главные герои предложения — кто/что и что делает?" },
            { level: 1, question: "Найди движок и раму: 'Мой питбайк легко заводится.'", options: ["мой питбайк", "легко заводится", "питбайк заводится"], correct: 2, explanation: "Питбайк (что делает?) заводится. Это подлежащее и сказуемое.", hint: "Рама — это предмет, двигатель — его действие." },
            { level: 1, question: "Определи основу: 'Электрический самокат быстро едет.'", options: ["самокат едет", "электрический самокат", "быстро едет"], correct: 0, explanation: "Подлежащее - самокат, сказуемое - едет.", hint: "Ищи, о чем говорится (предмет) и что оно делает (действие)." },
            { level: 1, question: "Что является основой в предложении: 'Стив построил дом.'", options: ["построил дом", "Стив построил", "Стив дом"], correct: 1, explanation: "Стив (что сделал?) построил.", hint: "Кто главный герой в этом предложении и что он сделал?" },
            { level: 2, question: "Какой режим у команды: 'Ты уже обновил Minecraft?'", options: ["Повествовательное", "Вопросительное", "Побудительное"], correct: 1, explanation: "Знак вопроса в конце всегда указывает на вопросительное предложение.", hint: "Посмотри на знак в конце предложения. О чем он говорит?" },
            { level: 2, question: "Включен ли 'Форсаж': 'Эта гонка была просто невероятной!'", options: ["Да, восклицательное", "Нет, невосклицательное"], correct: 0, explanation: "Восклицательный знак в конце означает, что предложение восклицательное.", hint: "Восклицательный знак = эмоции." },
            { level: 2, question: "Определи цель высказывания: 'Надень шлем перед поездкой.'", options: ["Повествовательное", "Вопросительное", "Побудительное"], correct: 2, explanation: "Предложение призывает к действию, значит, оно побудительное.", hint: "Это рассказ, вопрос или приказ?" },
            { level: 3, question: "Какая комплектация у основы: 'Вечер.'", options: ["Двусоставное", "Односоставное"], correct: 1, explanation: "В основе только один главный член — подлежащее 'вечер'. Значит, односоставное.", hint: "Есть ли в основе и подлежащее, и сказуемое, или только что-то одно?" },
            { level: 3, question: "Есть ли 'Полный обвес' в предложении: 'Зомби появились.'", options: ["Да, распространенное", "Нет, нераспространенное"], correct: 1, explanation: "Кроме основы 'зомби появились' других слов нет, значит, нераспространенное.", hint: "Кроме 'рамы' и 'движка' есть ли еще какие-то детали (слова)?" },
            { level: 4, question: "Полный техосмотр для: 'Мой друг построил портал в Нижний мир.' Выбери полный правильный разбор.", options: ["Повеств., невоскл., простое, двусоставное, нераспространенное", "Вопрос., невоскл., простое, двусоставное, распространенное", "Повеств., невоскл., простое, двусоставное, распространенное"], correct: 2, explanation: "Это рассказ (повеств.), без '!' (невоскл.), основа одна (простое), есть подл. и сказ. (двусоставное), есть доп. слова (распространенное).", hint: "Используй полный чек-лист из квестов." },
            { level: 4, question: "Какой 'паспорт' у предложения: 'Не гони на самокате!'", options: ["Побуд., воскл., простое, односоставное, распространенное", "Побуд., воскл., простое, двусоставное, нераспространенное", "Повеств., воскл., простое, односоставное, распространенное"], correct: 0, explanation: "Это призыв (побуд.), с '!' (воскл.), основа 'не гони' (односоставное), есть доп. слова (распространенное).", hint: "Разбери предложение по всем пунктам: цель, интонация, количество основ, состав основы, наличие 'обвеса'." },
            { level: 1, question: "В предложении 'Быстрый питбайк мчится по трассе' найди 'раму' (подлежащее).", options: ["мчится", "быстрый", "питбайк", "по трассе"], correct: 2, explanation: "Подлежащее отвечает на вопрос 'что?'. (Что?) питбайк. Это главный 'механизм' в предложении.", hint: "Что совершает действие? О чем идет речь в предложении?" },
            { level: 1, question: "В предложении 'Гонщик умело вошел в поворот' найди 'двигатель' (сказуемое).", options: ["гонщик", "умело", "в поворот", "вошел"], correct: 3, explanation: "Сказуемое отвечает на вопрос 'что сделал?'. Гонщик (что сделал?) вошел. Это действие 'рамы'.", hint: "Какое действие выполняет главный герой?" },
            { level: 2, question: "Какая из этих 'конструкций' является сложной (имеет две или больше основ)?", options: ["Наступил вечер, и гонщики разъехались.", "Гонщики устали после долгой гонки.", "На финише их ждали механики.", "Победа была близка."], correct: 0, explanation: "Здесь две основы: 1. вечер наступил; 2. гонщики разъехались. Два 'двигателя' в одной системе!", hint: "Ищи предложение, в котором есть два набора 'рама+двигатель'." },
            { level: 2, question: "В каком предложении есть 'одинаковые запчасти' (однородные члены)?", options: ["Механик проверил колеса.", "Нужно залить топливо и масло.", "Трасса была очень сложной.", "Зрители громко аплодировали."], correct: 1, explanation: "Однородные члены 'топливо' и 'масло' отвечают на один и тот же вопрос (залить что?) и относятся к одному слову.", hint: "Ищи слова, которые отвечают на один и тот же вопрос и соединены союзом 'и' или запятой." },
            { level: 3, question: "Определи тип 'моноколеса' (односоставного предложения): 'В гараже пахнет бензином.'", options: ["Назывное (только подлежащее)", "Определенно-личное", "Неопределенно-личное", "Безличное"], correct: 3, explanation: "Это безличное предложение. Действие происходит само по себе, без действующего лица.", hint: "Можно ли подставить в это предложение 'я', 'ты', 'они' или вообще никого?" },
            { level: 3, question: "В каком предложении перед союзом 'и' НЕ нужна запятая?", options: ["Солнце светило и птицы пели.", "Гонщик проверил мотор и надел шлем.", "Наступила ночь и зажглись фонари.", "Ветер усилился и пошел дождь."], correct: 1, explanation: "Запятая не ставится, если союз 'и' соединяет однородные сказуемые ('проверил' и 'надел'), относящиеся к одному подлежащему ('гонщик').", hint: "Запятая перед 'и' обычно ставится в сложных предложениях. А если действия выполняет один и тот же персонаж?" },
            { level: 3, question: "В предложении 'Я вернусь, когда закончится гонка' найди 'дополнительный модуль' (придаточное предложение).", options: ["Я вернусь", "вернусь, когда", "когда закончится гонка", "закончится гонка"], correct: 2, explanation: "Придаточное предложение содержит подчинительный союз ('когда') и зависит от главного предложения (Я вернусь (когда?)).", hint: "Ищи часть предложения, которая начинается с союзов 'когда', 'чтобы', 'потому что', 'если' и т.д." },
            { level: 4, question: "Найди 'бортовой компьютер' (вводное слово), который нужно выделить запятыми.", options: ["Мой питбайк кажется самым быстрым.", "К счастью гонка прошла без аварий.", "Вероятно завтра будет дождь.", "Возможно все закончится хорошо."], correct: 1, explanation: "'К счастью' — это вводное слово, выражающее эмоции говорящего. Оно не является членом предложения и выделяется запятой.", hint: "Попробуй убрать это слово из предложения. Смысл сохранится?" },
            { level: 4, question: "Где правильно расставлены знаки препинания для 'тюнинга' (причастного оборота)?", options: ["Гонщик уставший после заезда, пошел отдыхать.", "Гонщик, уставший после заезда пошел отдыхать.", "Гонщик, уставший после заезда, пошел отдыхать.", "Гонщик уставший, после заезда, пошел отдыхать."], correct: 2, explanation: "Причастный оборот 'уставший после заезда' стоит после определяемого слова 'гонщик', поэтому выделяется запятыми с двух сторон.", hint: "Причастный оборот, стоящий ПОСЛЕ слова, к которому он относится, 'закрывается' запятыми с обеих сторон." },
            { level: 4, question: "Какой 'апгрейд' установлен в предложении: 'Солнце село, но на трассе еще было светло, потому что горели прожекторы.'?", options: ["Только сочинительная связь", "Только подчинительная связь", "Сочинительная и подчинительная связь", "Бессоюзная связь"], correct: 2, explanation: "Здесь есть сочинительная связь (союз 'но') и подчинительная связь (союз 'потому что'). Это сложная конструкция с разными видами связи.", hint: "Ищи разные типы союзов: одни соединяют 'равноправные' части, другие — 'главную' и 'зависимую'." }
        ];
        
        // -------------------- DOM-элементы --------------------
        const cardElement = document.getElementById('card');
        const cardTitleFront = document.getElementById('card-title-front');
        const cardContentFront = document.getElementById('card-content-front');
        const cardTitleBack = document.getElementById('card-title-back');
        const cardContentBack = document.getElementById('card-content-back');
        const prevBtn = document.getElementById('prev-btn');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const goToTestBtn = document.getElementById('goToTestBtn');
        const progressBarFill = document.getElementById('progress-bar-fill');
        const progressBarText = document.getElementById('progress-bar-text');
        const bikeContainer = document.getElementById('bike-container');
        const cardsBtn = document.getElementById('cardsBtn');
        const testBtn = document.getElementById('testBtn');
        const cardsSection = document.getElementById('cardsSection');
        const testSection = document.getElementById('testSection');
        const quizContainer = document.getElementById('quiz-container');
        const checkResultsBtn = document.getElementById('checkResultsBtn');
        const resultsContainer = document.getElementById('results-container');
        const newAttemptBtn = document.getElementById('newAttemptBtn');
        
        // -------------------- Звуковой движок --------------------
        const soundEngine = {
            audioCtx: null,
            init() {
                document.body.addEventListener('click', () => {
                    if (!this.audioCtx) {
                        this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    }
                }, { once: true });
            },
            _playSound(type, frequency, duration, volume = 0.1) {
                if (!this.audioCtx) return;
                const oscillator = this.audioCtx.createOscillator();
                const gainNode = this.audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(this.audioCtx.destination);
                
                oscillator.type = type;
                oscillator.frequency.setValueAtTime(frequency, this.audioCtx.currentTime);
                gainNode.gain.setValueAtTime(volume, this.audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, this.audioCtx.currentTime + duration);

                oscillator.start();
                oscillator.stop(this.audioCtx.currentTime + duration);
            },
            playFlip() { this._playSound('sine', 600, 0.15); },
            playClick() { this._playSound('triangle', 800, 0.05); },
            playCorrect() { this._playSound('sine', 523.25, 0.2); },
            playIncorrect() { this._playSound('square', 150, 0.3); },
            playStart() { this._playSound('sawtooth', 200, 0.2); },
            playHint() { this._playSound('sine', 700, 0.1, 0.05); }
        };

        // -------------------- Логика раздела с карточками --------------------
        function displayCard(index) {
            const cardData = cards[index];
            cardElement.classList.remove('is-flipped');
            cardTitleFront.textContent = cardData.title;
            cardContentFront.innerHTML = `
                <p><span class="label">Миссия:</span> ${cardData.front.mission}</p>
                <p><span class="label">Теория:</span> ${cardData.front.theory}</p>
                ${cardData.front.example ? `<p><span class="label">Пример:</span> <span class="code">${cardData.front.example}</span></p>` : ''}
            `;
            cardTitleBack.textContent = "Тест-драйв";
            cardContentBack.innerHTML = `
                <div class="practice-item">
                    <p><span class="label">Задание:</span> ${cardData.back.task}</p>
                    <button class="btn check-btn show-answer-btn">Показать ответ</button>
                    <div class="answer-container answer-hidden">
                         <p><span class="label">Ответ:</span> <span class="code">${cardData.back.answer}</span></p>
                    </div>
                </div>
            `;
            updateNavButtons();
            updateProgressBar();
        }

        function updateNavButtons() {
            prevBtn.disabled = currentCardIndex === 0;
            const isLastCard = currentCardIndex === cards.length - 1;
            nextBtn.style.display = isLastCard ? 'none' : 'inline-block';
            goToTestBtn.style.display = isLastCard ? 'inline-block' : 'none';
        }

        function updateProgressBar() {
            const progressPercentage = ((currentCardIndex) / (cards.length - 1)) * 100;
            progressBarFill.style.width = `${progressPercentage}%`;
            progressBarText.textContent = `Этап ${currentCardIndex + 1} / ${cards.length}`;
            bikeContainer.style.left = `calc(${progressPercentage}% - 2%)`;
        }
        
        // -------------------- Логика навигации по разделам --------------------
        function navigateTo(sectionName) {
            const isCards = sectionName === 'cards';
            cardsSection.classList.toggle('active', isCards);
            testSection.classList.toggle('active', !isCards);
            cardsBtn.classList.toggle('active', isCards);
            testBtn.classList.toggle('active', !isCards);
            soundEngine.playClick();
        }

        // -------------------- Логика раздела с тестом --------------------
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function renderQuizQuestions() {
            quizContainer.innerHTML = '';
            currentQuizQuestions.forEach((q, index) => {
                const questionBlock = document.createElement('div');
                questionBlock.className = 'quiz-question';
                questionBlock.dataset.questionIndex = index;
                
                const questionText = document.createElement('p');
                questionText.textContent = `${index + 1}. ${q.question}`;
                questionBlock.appendChild(questionText);

                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'quiz-controls';
                controlsDiv.innerHTML = `<button class="hint-btn">💡 Подсказка</button>`;
                questionBlock.appendChild(controlsDiv);

                const hintP = document.createElement('p');
                hintP.className = 'hint-text';
                questionBlock.appendChild(hintP);

                const optionsDiv = document.createElement('div');
                optionsDiv.className = 'answer-options';
                
                q.options.forEach((option, i) => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.dataset.optionIndex = i;
                    optionsDiv.appendChild(button);
                });

                questionBlock.appendChild(optionsDiv);
                const explanationP = document.createElement('p');
                explanationP.className = 'explanation';
                questionBlock.appendChild(explanationP);
                quizContainer.appendChild(questionBlock);
            });
        }

        function generateAndRenderQuiz() {
            soundEngine.playStart();
            resultsContainer.innerHTML = '';
            quizContainer.innerHTML = '<p>Генерация новой трассы...</p>';
            
            const questionsPerLevel = { '1': 3, '2': 3, '3': 2, '4': 2 }; // More questions
            currentQuizQuestions = [];

            for (const level in questionsPerLevel) {
                const questionsOfLevel = questionBank.filter(q => q.level == level);
                shuffleArray(questionsOfLevel);
                currentQuizQuestions = currentQuizQuestions.concat(questionsOfLevel.slice(0, questionsPerLevel[level]));
            }
            shuffleArray(currentQuizQuestions);
            
            userAnswers = new Array(currentQuizQuestions.length).fill(null);
            renderQuizQuestions();
        }

        function generateMasterQuiz() {
            soundEngine.playStart();
            resultsContainer.innerHTML = '';
            quizContainer.innerHTML = '<p>Генерация Мастер-трассы... Сложность повышена!</p>';
            
            const masterQuestions = questionBank.filter(q => q.level >= 3);
            shuffleArray(masterQuestions);
            
            currentQuizQuestions = masterQuestions.slice(0, 8); // 8 master questions
            
            if (currentQuizQuestions.length === 0) {
                 quizContainer.innerHTML = '<p>Не найдено вопросов для мастер-уровня.</p>';
                 return;
            }

            userAnswers = new Array(currentQuizQuestions.length).fill(null);
            renderQuizQuestions(); // Re-use the rendering function
            
            // Add a visual tag for master questions
            quizContainer.querySelectorAll('.quiz-question p:first-child').forEach(p => {
                p.innerHTML = `<b>[Мастер]</b> ${p.textContent}`;
            });
        }
        
        function handleHintClick(button) {
            const questionBlock = button.closest('.quiz-question');
            if (!questionBlock) return;

            const questionIndex = parseInt(questionBlock.dataset.questionIndex, 10);
            const hintText = currentQuizQuestions[questionIndex].hint;
            
            const hintElement = questionBlock.querySelector('.hint-text');
            hintElement.textContent = `💡 Подсказка: ${hintText}`;
            hintElement.style.display = 'block';

            button.disabled = true;
            soundEngine.playHint();
        }

        function handleQuizAnswer(button) {
            const questionBlock = button.closest('.quiz-question');
            if (!questionBlock || button.parentElement.querySelector('button:disabled')) return;

            const questionIndex = parseInt(questionBlock.dataset.questionIndex, 10);
            const selectedOptionIndex = parseInt(button.dataset.optionIndex, 10);
            const optionsDiv = button.parentElement;

            userAnswers[questionIndex] = selectedOptionIndex;
            const correctIndex = currentQuizQuestions[questionIndex].correct;
            const explanation = currentQuizQuestions[questionIndex].explanation;

            Array.from(optionsDiv.children).forEach(btn => btn.disabled = true);
            
            if (selectedOptionIndex === correctIndex) {
                button.classList.add('correct');
                soundEngine.playCorrect();
            } else {
                button.classList.add('incorrect');
                if (optionsDiv.children[correctIndex]) {
                    optionsDiv.children[correctIndex].classList.add('correct');
                }
                soundEngine.playIncorrect();
            }
            
            const explanationEl = questionBlock.querySelector('.explanation');
            explanationEl.textContent = `Пояснение: ${explanation}`;
            explanationEl.style.display = 'block';
        }

        function showResults() {
             if (userAnswers.includes(null)) {
                resultsContainer.innerHTML = `<p style="color: var(--accent-orange);">Нужно ответить на все вопросы!</p>`;
                return;
            }

            let score = 0;
            const wrongQuestionLevels = new Set();
            userAnswers.forEach((answer, index) => {
                const question = currentQuizQuestions[index];
                if (answer === question.correct) {
                    score++;
                } else {
                    wrongQuestionLevels.add(question.level);
                }
            });

            const totalQuestions = currentQuizQuestions.length;
            const percentage = (score / totalQuestions) * 100;

            let feedbackMessage = '';
            let reviewTopicsHTML = '';
            let actionButtons = `
                <button data-action="retry" class="btn check-btn">Новый заезд</button>
                <button data-action="practice" class="btn nav-btn-style">К карточкам</button>
            `;
            
            const topicMap = {
                1: 'Основы: Подлежащее и сказуемое (Этапы 1-2)',
                2: 'Типы предложений и сложные конструкции (Этапы 3, 5)',
                3: 'Односоставные предложения и пунктуация (Этап 4)',
                4: 'Полный разбор и сложные случаи (Все Этапы)'
            };

            if (wrongQuestionLevels.size > 0) {
                let topicsList = '';
                wrongQuestionLevels.forEach(level => {
                    if (topicMap[level]) {
                        topicsList += `<li>${topicMap[level]}</li>`;
                    }
                });
                reviewTopicsHTML = `<ul class="review-topics">${topicsList}</ul>`;
            }

            if (percentage < 50) {
                feedbackMessage = `<p class="feedback-message feedback-low">Неплохая попытка, но похоже, некоторые детали ускользнули. Нужно подтянуть базу!</p>
                                   <p class="feedback-message">Рекомендую повторить эти темы в Учебных карточках:</p>${reviewTopicsHTML}`;
            } else if (percentage < 100) {
                feedbackMessage = `<p class="feedback-message">Отличная работа! Ты почти у цели. Еще немного практики, и ты станешь настоящим мастером-механиком!</p>
                                   <p class="feedback-message">Обрати внимание на эти темы:</p>${reviewTopicsHTML}`;
            } else { // 100%
                feedbackMessage = `<p class="feedback-message feedback-high">🏆 ИДЕАЛЬНЫЙ ЗАЕЗД! 🏆</p>
                                   <p class="feedback-message">Ты — настоящий чемпион "Синтаксис-Гаража"! Готов к новому вызову?</p>`;
                actionButtons = `
                    <button data-action="master-quiz" class="btn" style="background-color: var(--accent-orange); color: #000;">Мастер-уровень</button>
                    ${actionButtons}
                `;
            }

            resultsContainer.innerHTML = `
                <p>Твой результат: ${score} из ${totalQuestions}!</p>
                ${feedbackMessage}
                <div class="results-actions">
                    ${actionButtons}
                </div>
            `;
            soundEngine.playStart();
        }

        // -------------------- Инициализация и обработчики событий --------------------
        function init() {
            soundEngine.init();

            // Карточки
            checkBtn.addEventListener('click', () => {
                cardElement.classList.toggle('is-flipped');
                soundEngine.playFlip();
            });
            nextBtn.addEventListener('click', () => {
                if (currentCardIndex < cards.length - 1) {
                    currentCardIndex++;
                    displayCard(currentCardIndex);
                    soundEngine.playClick();
                }
            });
            prevBtn.addEventListener('click', () => {
                if (currentCardIndex > 0) {
                    currentCardIndex--;
                    displayCard(currentCardIndex);
                    soundEngine.playClick();
                }
            });
            
            cardsSection.addEventListener('click', (event) => {
                if (event.target.classList.contains('show-answer-btn')) {
                    const btn = event.target;
                    const answerContainer = btn.nextElementSibling;
                    if (answerContainer) {
                        answerContainer.classList.remove('answer-hidden');
                        btn.style.display = 'none';
                        soundEngine.playClick();
                    }
                }
            });

            // Навигация
            cardsBtn.addEventListener('click', () => navigateTo('cards'));
            testBtn.addEventListener('click', () => {
                navigateTo('test');
                generateAndRenderQuiz();
            });
            goToTestBtn.addEventListener('click', () => {
                navigateTo('test');
                generateAndRenderQuiz();
            });

            // Тест
            quizContainer.addEventListener('click', (event) => {
                const button = event.target;
                if (button.matches('.answer-options button')) {
                    handleQuizAnswer(button);
                } else if (button.matches('.hint-btn')) {
                    handleHintClick(button);
                }
            });
            newAttemptBtn.addEventListener('click', generateAndRenderQuiz);
            checkResultsBtn.addEventListener('click', showResults);
            
            resultsContainer.addEventListener('click', (event) => {
                const button = event.target.closest('button');
                if (!button) return;

                const action = button.dataset.action;
                if (action === 'retry') {
                    generateAndRenderQuiz();
                } else if (action === 'practice') {
                    navigateTo('cards');
                } else if (action === 'master-quiz') {
                    generateMasterQuiz();
                }
            });

            // --- Первый запуск ---
            displayCard(currentCardIndex);
        }

        init();
    });
    </script>
</body>
</html>
